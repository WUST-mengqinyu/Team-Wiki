
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://wiki.badcw.cn/Personal%20Page/badcw/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9dp%E7%9A%84%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/">
      
      <link rel="icon" href="../../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>状态压缩dp的相关问题 - Team Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.1dff34a1.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dp" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../.." title="Team Wiki" class="md-header__button md-logo" aria-label="Team Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.03A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.03A6.004 6.004 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.97Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Team Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              状态压缩dp的相关问题
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Team Wiki" class="md-nav__button md-logo" aria-label="Team Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.03A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.03A6.004 6.004 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.97Z"/></svg>

    </a>
    Team Wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          主页
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="主页" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          主页
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        赛季列表
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          个人页面
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="个人页面" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          个人页面
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Verly/" class="md-nav__link">
        Verly
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        badcw
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          关于
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="关于" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          关于
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../About/About/" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1、枚举二进制状态子集
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2、状态的各种基本操作
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3dp" class="md-nav__link">
    3、轮廓线dp入门
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4dp" class="md-nav__link">
    4、插头dp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5dp" class="md-nav__link">
    5、状压dp其他细节
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6dp" class="md-nav__link">
    6、分辨状压dp和费用流
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="dp">状态压缩dp的相关问题<a class="headerlink" href="#dp" title="Permanent link">Link</a></h1>
<p>状态压缩dp常用来处理量级很小的np问题</p>
<p>由此还可以衍生出轮廓线dp及在此之上的插头dp</p>
<p>状态的二进制表示法中有一些小操作想分享一下：</p>
<h2 id="1">1、枚举二进制状态子集<a class="headerlink" href="#1" title="Permanent link">Link</a></h2>
<pre class="highlight"><code class="language-c++">//for(int i = 0; i != s; i = (i-s)&amp;s)
void print(int x) {
    if (x &lt; 2) printf("%d", x);
    else {
        print(x &gt;&gt; 1);
        print(x % 2);
    }
}

int main() {
    int s = 0B1111;
    for (int i = 0; i != s; i = (i - s) &amp; s) {
        print(i);
        printf("\n");
    }
}
/*输出为：
0
1
10
11
100
101
110
111
1000
1001
1010
1011
1100
1101
1110
*/</code></pre>
<p>很方便而且是升序</p>
<h2 id="2">2、状态的各种基本操作<a class="headerlink" href="#2" title="Permanent link">Link</a></h2>
<pre class="highlight"><code class="language-c++">// 所有位为1
(1&lt;&lt;n)-1 //注意位运算比一次运算优先级低所以要加括号
// 判断第i位
stat &amp; (1&lt;&lt;i)
// lowbit，状态中最靠近末尾的1
i &amp; -i
// 求状态中含有的选中数量，相当于求二进制位中1的个数
int c = 0;
for (int i = 0; i &lt; n; ++i) if (stat &amp; (1&lt;&lt;i)) c++;
// 或者直接预处理，这里用到了lowbit
for (int i = 0; i &lt; (1&lt;&lt;n); ++i) c[i] = c[i ^ (i &amp; -i)] + 1;
// 枚举递推下一个状态，其实随便写就是了
for (int i = 0; i &lt; n; ++i) {
    if ((stat &amp; (1&lt;&lt;i)) == 0) {
        int newstat = stat | (1&lt;&lt;i);
    }
}</code></pre>
<h2 id="3dp">3、轮廓线dp入门<a class="headerlink" href="#3dp" title="Permanent link">Link</a></h2>
<p>说到轮廓线dp就是那个方格填充问题，求用1*2的方格填满n×m的方案数。 【poj 2411】</p>
<ul>
<li>
<p>这里是基础部分，会的可以跳过</p>
</li>
<li>
<p>设计<span class="arithmatex"><span class="MathJax_Preview"> dp[i][j][k] </span><script type="math/tex"> dp[i][j][k] </script></span>是第i行第j列，上方状态为k的方案数</p>
</li>
<li>
<p>最后求解的是<span class="arithmatex"><span class="MathJax_Preview"> dp[n][m][(1&lt;&lt;m)-1] </span><script type="math/tex"> dp[n][m][(1<<m)-1] </script></span></p>
</li>
<li>
<p>0000xxx</p>
</li>
</ul>
<p>xxxx000</p>
<p>这样一张图，表示枚举到了第2行第4列，那么它所需要的状态为标x的位置是否填充，往下递推将第2行第5列填充一个竖着的方格的话就是：</p>
<pre class="highlight"><code class="language-cpp">int newstat = stat &gt;&gt; 1 | (1 &lt;&lt; m - 1) | 1</code></pre>
<p>其中 stat&gt;&gt;1 就是把状态变成了</p>
<p>00000xx</p>
<p>xxxxx00</p>
<p>去掉了头位，增加了一位，这就是轮廓线dp，类似一个取窗口shift的过程。标x的位置也就是轮廓线。</p>
<p>方格填充问题的具体解答是：</p>
<p>1、每次枚举只有三种情况，一是此位置不填，二是此位置填竖着的1×2也就是上一行同列和此位置，三是填横着的也就是上一列同行和此位置</p>
<p>2、如果轮廓线中上一行同列的位置为空必须要填上不然之后就没有方法可以将那个位置补上所以是</p>
<pre class="highlight"><code class="language-cpp">if ((stat &amp; 2) == 0) {
    int newstat = stat &gt;&gt; 1 | (1 &lt;&lt; m - 1) | 1;
    dp[i][j][newstat] += dp[i][j - 1][stat];//i,j-1看情况改动，是它上一个状态的位置
    continue;
}</code></pre>
<p>注意此时要不是第一行，根据你从1还是0开始记录行数可能有负下标的风险所以判断一下i是否大于开始行下标</p>
<p>3、如果不是以上情况就可以不填</p>
<pre class="highlight"><code class="language-cpp">int newstat = stat &gt;&gt; 1;
dp[i][j][newstat] += dp[i][j - 1][stat];</code></pre>
<p>4、如果左边为空可以填</p>
<pre class="highlight"><code class="language-cpp">if ((stat &amp; (1&lt;&lt;m - 1)) == 0) {
    int newstat = stat &gt;&gt; 1 | 3;
    dp[i][j][newstat] += dp[i][j - 1][stat];
}</code></pre>
<p>当然以上只是解释性的写法，真要做题的话显然可以加个滚动数组，它每个点都只与上一个状态相关，而且写起来反而更简单。</p>
<p>我习惯来讲是把最远位看做0位，因为可以右溢</p>
<p>0000xxx</p>
<p>xxxx000</p>
<p>简单来讲比如这个枚举到了第2行第4列</p>
<p>那么它状态就要去表示标“x”的位置，如果把它正上方（也就是1，5）那个点看做是状态的最后一位也就是0位，在往下递推的过程中就能够</p>
<pre class="highlight"><code class="language-cpp">int newstat = stat &gt;&gt; 1 | (1&lt;&lt;m-1)</code></pre>
<p>直接得出下一组状态，不需要考虑溢出位</p>
<p>如果反着设计状压也可以使用取模来减去溢出位</p>
<p>一道题：codeforces 903F</p>
<p>大意：给一个4×m的矩阵，有些位置为x，需要用1×1， 2×2，3×3， 4×4的格子将其填充使得所有x位置都要被覆盖。每种格子有一个代价，求最小代价。</p>
<p>显然此题轮廓线大小为4*4也就是前16个格子，考虑从左往右、从下往上递推即可。</p>
<p>唯一不好处理的是这个代价问题。</p>
<p>强烈推荐读一下dotorya的代码，简直神作，读到就是赚到</p>
<pre class="highlight"><code class="language-cpp">// https://codeforces.com/contest/903/submission/33174261
int A[5];
int val[5];
char in[4][1050];
 
int nxt[65536][120];
int cost[120];
 
int dp[1050][4096];
int main() {
    int N, i, j, k, l, m;
    scanf("%d", &amp;N);
    for (i = 1; i &lt;= 4; i++) scanf("%d", &amp;A[i]);
    for (i = 0; i &lt; 4; i++) scanf("%s", in[i]);
    for (i = 1; i &lt;= 4; i++) {
        for (j = 0; j &lt; i; j++) for (k = 0; k &lt; i; k++) val[i] |= 1 &lt;&lt; (4 * j + k);
    }
 
    int p = 0;
    for (i = 0; i &lt;= 1; i++) {
        for (j = 0; j &lt;= 2; j++) {
            for (k = 0; k &lt;= 3; k++) {
                for (l = 0; l &lt;= 4; l++) {
                    int totc = A[i] + A[j] + A[k] + A[l];
                    cost[p] = totc;
                    int v = (val[i] &lt;&lt; 3) | (val[j] &lt;&lt; 2) | (val[k] &lt;&lt; 1) | val[l];
                    for (m = 0; m &lt; 65536; m++) nxt[m][p] = m &amp; ~v;
                    p++;
                }
            }
        }
    }
 
    memset(dp, 0x3f, sizeof(dp));
    int st = 0;
    for (i = 0; i &lt; 1; i++) {
        for (j = 0; j &lt; 4; j++) {
            st = st * 2;
            if (in[j][i] == '*') st++;
        }
    }
    for (i = 0; i &lt; 120; i++) dp[0][nxt[st][i]] = min(dp[0][nxt[st][i]], cost[i]);
    for (i = 1; i &lt; N; i++) {
        int v = 0;
        for (j = 0; j &lt; 4; j++) v = v * 2 + (int)(in[j][i] == '*');
        for (j = 0; j &lt; 4096; j++) {
            if (dp[i-1][j] &gt; 1000000) continue;
 
            l = j * 16 + v;
            for (k = 0; k &lt; 120; k++) {
                int x = nxt[l][k];
                if (x &lt; 4096) dp[i][x] = min(dp[i][x], dp[i - 1][j] + cost[k]);
            }
        }
    }
 
    return !printf("%d\n", dp[N - 1][0]);
}</code></pre>
<p>首先<span class="arithmatex"><span class="MathJax_Preview"> val[1～4] </span><script type="math/tex"> val[1～4] </script></span>表示了1×1到4×4的方格填充的轮廓线形状</p>
<p>然后预处理中的一个 nxt 数组是真的精髓，<span class="arithmatex"><span class="MathJax_Preview"> net[m][p] </span><script type="math/tex"> net[m][p] </script></span>表示的是把m状态经过p这个转移方式可以转移到的状态，p这个转移方式的代价为<span class="arithmatex"><span class="MathJax_Preview">cost[p]</span><script type="math/tex">cost[p]</script></span>，由于状压dp这种东西真的是不能表示很多状态，题目的数据范围也会很小，这样的预处理不仅可以很好的提高代码运行效率还可以减低我们的编写难度。</p>
<p>注意他这里转移方式的总数的问题，其实我们说16个格子用1~4的方格填满最多甚至需要16个1*1，但是4个1× 1必然是只与前一列相关联，所以最多4个就可以解决所有问题p的状态数就是<span class="arithmatex"><span class="MathJax_Preview">1×2×3×4=24</span><script type="math/tex">1×2×3×4=24</script></span>种，虽然不明白他为何要写成120种但是这个nxt数组的优越性就体现出来了，就算后面的p不做处理，它仍然是正确的，因为nxt数组默认指向0，再怎么瞎弄它最终0既不是答案，也不能改变中间状态，同时代价也是0。</p>
<p>然后可以说后面随便设计轮廓线都是可以写的了，不过多赘述。</p>
<h2 id="4dp">4、插头dp<a class="headerlink" href="#4dp" title="Permanent link">Link</a></h2>
<p>等哪天会手撕了再写</p>
<p>大概步骤是：设计轮廓线-&gt;设计插头编码-&gt;考虑hashmap的存储-&gt;设计状态转移-&gt;开始上手</p>
<p>这个算法让我觉得在做程序设计而不是算法设计。</p>
<h2 id="5dp">5、状压dp其他细节<a class="headerlink" href="#5dp" title="Permanent link">Link</a></h2>
<ul>
<li>
<p>顺序问题：</p>
</li>
<li>
<p>例题：<a href="https://www.cometoj.com/contest/52/problem/C">https://www.cometoj.com/contest/52/problem/C</a></p>
</li>
<li>
<p>很精髓的一题，求解所有合法排列的逆序对<span class="arithmatex"><span class="MathJax_Preview"> ∣i−j∣ × ∣pos_j−pos_i∣ </span><script type="math/tex"> ∣i−j∣ × ∣pos_j−pos_i∣ </script></span>的权值和</p>
</li>
<li>
<p>本来状压解决这种问题相当困难，因为相当于是一个带顺序的选择问题，一般来讲暴力是阶乘级别的算法，但是这种问题就和状压dp解决旅行商问题一样，将阶乘复杂度降低到指数级。</p>
</li>
<li>
<p>其实可以对已选择的位置进行状压，然后添加序列就是从小到大，这样就可以不必考虑顺序。</p>
</li>
<li>
<p>用一个<span class="arithmatex"><span class="MathJax_Preview"> dp[1&lt;&lt;maxn] </span><script type="math/tex"> dp[1<<maxn] </script></span>表示某种选择下的权值贡献</p>
</li>
<li>
<p>这样降低复杂度的原因是其实它状态中1的个数就是当前取的数的大小-1。</p>
</li>
<li>
<p>考虑转移方乘：</p>
</li>
<li>
<p><span class="arithmatex"><span class="MathJax_Preview"> dp[s] = \sum (dp[s'] + \sum_{x=s \bigoplus s'+1}^n(pre - t)*(x - s\bigoplus s')) </span><script type="math/tex"> dp[s] = \sum (dp[s'] + \sum_{x=s \bigoplus s'+1}^n(pre - t)*(x - s\bigoplus s')) </script></span></p>
</li>
<li>
<p>其中s&rsquo;表示s的子集，t表示s&rsquo;中1的个数（即当前取的数-1），pre表示比t小的某个数</p>
</li>
<li>
<p>看似不可解，其实由于确定了从小到大放数的顺序，它真正每种情况的顺序反而变得不那么重要了。</p>
</li>
<li>
<p>记录<span class="arithmatex"><span class="MathJax_Preview"> g[1&lt;&lt;maxn] </span><script type="math/tex"> g[1<<maxn] </script></span>表示某种状态的可能排列个数</p>
</li>
<li>
<p><span class="arithmatex"><span class="MathJax_Preview"> t[1&lt;&lt;maxn][maxn] </span><script type="math/tex"> t[1<<maxn][maxn] </script></span>表示某种状态下某位置上所有排列可能性的值的和。</p>
</li>
<li>
<p>由于下一种状态的数比已添加的数都大，所以只要是包含在值内且在当前位置后面的数都是逆序对。</p>
</li>
<li>
<p>转移就变简单了</p>
</li>
<li>
<p>设s的二进制表示中1的个数为y，枚举到的位置（<span class="arithmatex"><span class="MathJax_Preview"> s\bigoplus s' </span><script type="math/tex"> s\bigoplus s' </script></span>）为x</p>
</li>
<li>
<p>则有</p>
</li>
<li>
<div class="arithmatex">
<div class="MathJax_Preview">
  \begin{cases} 
  dp[s] = \sum_{s'} (dp[s'] + \sum_{z&gt;x，z\in s'} (z - x)*(g[s]*y - t[s][z]))
  \\
  t[s][i] = \sum_{s'}(t[s][i]) &amp; \text{i != x}
  \\
  t[s][x] = \sum_{s'}(g[s]*y + t[s][x])
  \\
  g[s] = \sum_{s'}g[s']
  \end{cases}
  </div>
<script type="math/tex; mode=display">
  \begin{cases} 
  dp[s] = \sum_{s'} (dp[s'] + \sum_{z>x，z\in s'} (z - x)*(g[s]*y - t[s][z]))
  \\
  t[s][i] = \sum_{s'}(t[s][i]) & \text{i != x}
  \\
  t[s][x] = \sum_{s'}(g[s]*y + t[s][x])
  \\
  g[s] = \sum_{s'}g[s']
  \end{cases}
  </script>
</div>
</li>
<li>
<p>看的有点云里雾里，实际上就是把所有子集的情况都累加到一起，t数组就是用来储存每位上子集所有情况的数字和。然后每次把它后面的和加到dp数组即可</p>
</li>
<li>
<p>维护g数组是为了更新t数组，所以整个一来可以看出一个套路：</p>
</li>
<li>
<p>对一个带顺序和权值的状压dp，往往需要维护三个权值：状态的可能性个数、状态上每一位的权值和、状态本身代表的填充方式。</p>
</li>
<li>
<p>一道新题：codeforces 1152F1</p>
</li>
<li>
<p>大意：有n个物品，你可以选k个，每次选择的是之前没有选过而且设上一个的位置为x，当前物品只能在<span class="arithmatex"><span class="MathJax_Preview">1~x+m</span><script type="math/tex">1~x+m</script></span>之间选择，求选k个的方案数</p>
</li>
<li>
<p>又是指定了顺序，如果确定（坐标）从小往大取，那么当前要取的点只与前m个位置的取数情况有关，这个点要么直接是最后一个取，要么之前m位有取过的情况下可以是它们转移过来。</p>
</li>
<li>
<p>直接设计轮廓线为前m个位置的取数情况</p>
</li>
<li>
<p><span class="arithmatex"><span class="MathJax_Preview"> dp[i][j][k] </span><script type="math/tex"> dp[i][j][k] </script></span>表示前i个物品，取了j个，i-k到i的取数情况为k的方案数。</p>
</li>
<li>
<p><span class="arithmatex"><span class="MathJax_Preview"> dp[i + 1][j][stat&gt;&gt;1] += dp[i][j][stat] </span><script type="math/tex"> dp[i + 1][j][stat>>1] += dp[i][j][stat] </script></span>表示不取直接把轮廓线移位</p>
</li>
<li>
<p><span class="arithmatex"><span class="MathJax_Preview"> dp[i + 1][j + 1][stat&gt;&gt;1|(1&lt;&lt;m-1)] += dp[i][j][stat] * (bitcount(stat) + 1) </span><script type="math/tex"> dp[i + 1][j + 1][stat>>1|(1<<m-1)] += dp[i][j][stat] * (bitcount(stat) + 1) </script></span> 表示取最后一个，方案与前m个位置情况相关</p>
</li>
<li>
<p>此题large版本的n范围扩大到了1e9，就涉及到一个不怎么常见的操作：轮廓线+矩阵快速幂，一般来讲轮廓线的第一维是可以用滚动数组代替的，因为往往确定了枚举顺序之后每一位其实就只与前一位有关，所以出成矩阵快速幂也是可以理解的，但是这个题目很怪异的是就算不算第一维，它还有一维取的数量和一个mask，那么这样一来矩阵快速幂需要维护的是一个矩阵本身，也就是三维矩阵快速幂，众所周知矩阵到二维递推基本无解，复杂度能上天，但是本题的m限制在了4以内而且k在12以内。将这个二维矩阵按mapindex缩成一维之后矩阵大小也只有<span class="arithmatex"><span class="MathJax_Preview">12*(1&lt;&lt;4)</span><script type="math/tex">12*(1<<4)</script></span>，总体复杂度就是<span class="arithmatex"><span class="MathJax_Preview">O(logn*(k*(1&lt;&lt;m))^3)</span><script type="math/tex">O(logn*(k*(1<<m))^3)</script></span>，还是在可接受范围之内</p>
</li>
<li>
<p>此题large版本的递推矩阵确实不太好计算，具体方式见<a href="../%E7%9F%A9%E9%98%B5%E5%BF%AB%E9%80%9F%E5%B9%82dp/#2">矩阵快速幂</a></p>
</li>
</ul>
<h2 id="6dp">6、分辨状压dp和费用流<a class="headerlink" href="#6dp" title="Permanent link">Link</a></h2>
<p>众所周知费用流和状压dp都是用来解决小范围数据的np问题的。那么当拿到一个题看的数据范围20甚至10以内怎样分辨也是一个问题。</p>
<p>状压dp有个很重要的特点就是：取还是不取，能不能取。</p>
<p>费用流有个很重要的特点：一般不用来解决线性问题。</p>
<p>那么首先应该看是否是线性或顺序无关的问题，如果是定是状压dp，否则看是否符合取不取的01规则，如果是定是状压dp，否则状压基本无法解决，考虑费用流和爆搜。</p>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy;  <a href="https://wiki.badcw.cn" target="_blank">wiki.badcw.cn</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.c99f48ec.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../../search/main.js"></script>
      
    
  </body>
</html>