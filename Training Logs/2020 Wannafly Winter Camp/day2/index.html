
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://wiki.badcw.cn/Training%20Logs/2020%20Wannafly%20Winter%20Camp/day2/">
      
      <link rel="icon" href="../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>Day2 - Team Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.1dff34a1.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Team Wiki" class="md-header__button md-logo" aria-label="Team Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.03A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.03A6.004 6.004 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.97Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Team Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Day2
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Team Wiki" class="md-nav__button md-logo" aria-label="Team Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.03A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.03A6.004 6.004 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.97Z"/></svg>

    </a>
    Team Wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          主页
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="主页" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          主页
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        赛季列表
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          个人页面
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="个人页面" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          个人页面
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Verly/index.md" class="md-nav__link">
        Verly
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../badcw/" class="md-nav__link">
        badcw
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          关于
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="关于" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          关于
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../About/About/" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    早上讲课
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    下午比赛
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-do-list" class="md-nav__link">
    To-do list
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a" class="md-nav__link">
    A. 托米的字符串
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    C. 纳新一百的石子游戏
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#e" class="md-nav__link">
    E. 阔力梯的树
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#f" class="md-nav__link">
    F. 采蘑菇的克拉莉丝
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#h" class="md-nav__link">
    H. 叁佰爱抠的序列
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#j-2-sat" class="md-nav__link">
    J. 邦邦的2-SAT模板
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k" class="md-nav__link">
    K. 破忒头的匿名信
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>Day2</h1>

<h2 id="_1">早上讲课<a class="headerlink" href="#_1" title="Permanent link">Link</a></h2>
<p>Div2 数据结构，属实没有什么盐分，从栈到线段树</p>
<p>最大收获是明确了 Segment Beats 的复杂度是 O(nlogn)，可以放心的使用线段树进行区间推平操作</p>
<h2 id="_2">下午比赛<a class="headerlink" href="#_2" title="Permanent link">Link</a></h2>
<table>
<thead>
<tr>
<th>Name</th>
<th align="center">Date</th>
<th align="center">Solved</th>
<th align="center">A</th>
<th align="center">B</th>
<th align="center">C</th>
<th align="center">D</th>
<th align="center">E</th>
<th align="center">F</th>
<th align="center">G</th>
<th align="center">H</th>
<th align="center">I</th>
<th align="center">J</th>
<th align="center">K</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://codeforces.com/group/6QKpZkKhsL/contest/265634">2020 CCPC Wannafly Winter Camp Day2 (Div.1&amp;2)</a></td>
<td align="center">2020/1/13</td>
<td align="center">7/11</td>
<td align="center">O</td>
<td align="center">.</td>
<td align="center">O</td>
<td align="center">.</td>
<td align="center">O</td>
<td align="center">O</td>
<td align="center">.</td>
<td align="center">O</td>
<td align="center">.</td>
<td align="center">O</td>
<td align="center">O</td>
</tr>
</tbody>
</table>
<p>仍然在前 20 名，很多串和图题，还是有点难顶</p>
<h2 id="to-do-list">To-do list<a class="headerlink" href="#to-do-list" title="Permanent link">Link</a></h2>
<p><code>C/F/J/K</code></p>
<h2 id="a">A. 托米的字符串<a class="headerlink" href="#a" title="Permanent link">Link</a></h2>
<p>求所有子串中元音字母占比的平均值</p>
<p>显然 <span class="arithmatex"><span class="MathJax_Preview">ans=\sum{\frac{x}{len}}</span><script type="math/tex">ans=\sum{\frac{x}{len}}</script></span>，若对单点计算贡献，那么 <span class="arithmatex"><span class="MathJax_Preview">ans_i = \sum\frac{1}{len}</span><script type="math/tex">ans_i = \sum\frac{1}{len}</script></span></p>
<p>考虑这样的情况</p>
<p><code>(1------i----n)</code></p>
<p>其中 <code>[1,i]</code> 长度为 <code>x</code>， <code>[i,n]</code> 长度为 <code>y</code>，设 <span class="arithmatex"><span class="MathJax_Preview">x \le y</span><script type="math/tex">x \le y</script></span> 显然对于 <code>[1,x]</code> 长度的串每个都有期望 1，然后对于 <code>[x+1,y]</code> 的串期望个数为 <code>x</code>。计算式为：<span class="arithmatex"><span class="MathJax_Preview">\sum_{i=x+1}^{y}\frac{x}{i}</span><script type="math/tex">\sum_{i=x+1}^{y}\frac{x}{i}</script></span>，对于 <code>[y+1,x+y-1]</code> 的串期望为 <code>[x-1,1]</code> 计算式为：<span class="arithmatex"><span class="MathJax_Preview">\sum_{i=y+1}^{x+y-1}\frac{x+y-i}{i}</span><script type="math/tex">\sum_{i=y+1}^{x+y-1}\frac{x+y-i}{i}</script></span> 化简为 <span class="arithmatex"><span class="MathJax_Preview">{x+y}\cdot\sum_{i=y+1}^{x+y-1}\frac{1}{i}-\sum_{i=y+1}^{x+y-1}1</span><script type="math/tex">{x+y}\cdot\sum_{i=y+1}^{x+y-1}\frac{1}{i}-\sum_{i=y+1}^{x+y-1}1</script></span> 对于 <span class="arithmatex"><span class="MathJax_Preview">\frac{1}{i}</span><script type="math/tex">\frac{1}{i}</script></span> 求前缀和即可</p>
<p>如果 <span class="arithmatex"><span class="MathJax_Preview">x &gt; y</span><script type="math/tex">x > y</script></span> 可以考虑交换，因为它们有对称性</p>
<details class="note">
<summary>Code</summary>
<pre class="highlight"><code class="language-cpp">/*================================================================
*   Copyright (C) 2019 Sangfor Ltd. All rights reserved.
*
*   创 建 者： badcw
*   创建日期： 2020/1/13
*
================================================================*/
#include &lt;bits/stdc++.h&gt;

#define ll long long
using namespace std;

const int maxn = 1e6+50;
const int mod = 1e9+7;
ll qp(ll a, ll n) {
    ll res = 1;
    while (n &gt; 0) {
        if (n &amp; 1) res = res * a % mod;
        a = a * a % mod;
        n &gt;&gt;= 1;
    }
    return res;
}

template &lt;class T&gt;
inline bool scan(T&amp; ret) {
    char c;
    int sgn;
    if (c = getchar(), c == EOF) return 0; // EOF
    while (c != '-' &amp;&amp; (c &lt; '0' || c &gt; '9')) c = getchar();
    sgn = (c == '-') ? -1 : 1;
    ret = (c == '-') ? 0 : (c - '0');
    while (c = getchar(), c &gt;= '0' &amp;&amp; c &lt;= '9') ret = ret * 10 + (c - '0');
    ret *= sgn;
    return 1;
}

//template &lt;class T&gt;
//inline void out(T x) {
//    if (x &gt; 9) out(x / 10);
//    putchar(x % 10 + '0');
//}


struct Frac {
    ll a, b;
    void getJian() {
        ll gcd = abs(__gcd(a, b));
        a /= gcd;
        b /= gcd;
        if (b &lt; 0) {
            a = -a;
            b = -b;
        }
    }
    Frac(ll a_ = 1, ll b_ = 1) {
        a = a_;
        b = b_;
        getJian();
    }
    Frac add(const Frac&amp; oth) {
        ll bt = b * oth.b;
        ll at = a * oth.b + oth.a * b;
        return Frac(at, bt);
    }
    Frac multi(const Frac&amp; oth) {
        a *= oth.a;
        b *= oth.b;
        getJian();
        return *this;
    }
    bool operator &lt; (const Frac&amp; oth) const {
        return a * oth.b &lt; b * oth.a;
    }
    bool operator == (const Frac&amp; oth) const {
        return a * oth.b == b * oth.a;
    }
    bool operator &lt;= (const Frac&amp; oth) const {
        return a * oth.b &lt;= b * oth.a;
    }
};

char s[maxn];
double pre[maxn];
//double pre2[maxn];

int main(int argc, char* argv[]) {
    scanf("%s", s + 1);
    int len = strlen(s + 1);
    for (int i = 1; i &lt;= len; ++i) {
        pre[i] = pre[i - 1] + 1.0 / i;
//        pre2[i] = pre2[i - 1] + pre[i];
    }
    double res = 0;
    for (int i = 1; i &lt;= len; ++i) {
        if (s[i] == 'a' || s[i] == 'e' || s[i] == 'i' || s[i] == 'o' || s[i] == 'u' || s[i] == 'y') {
            int x = i;
            int y = len - i + 1;
//            res += x * pre[y] - pre2[x - 1];
            if (x &gt; y) swap(x, y);
            res ++;
            res += x * (pre[y] - pre[x]);
            res += (x + y) * (pre[x + y - 1] - pre[y]);
//            res += (y - x) - x * (pre[y] - pre[x]);
        }
    }
    res /= len + (double)len * (len - 1) / 2;
    printf("%.10f\n", res);
    return 0;
}</code></pre>
</details>
<h2 id="c">C. 纳新一百的石子游戏<a class="headerlink" href="#c" title="Permanent link">Link</a></h2>
<details class="note">
<summary>Code</summary>
<pre class="highlight"><code class="language-cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N=500010;
typedef long long LL;
int n,m;
int cnt[100];
LL nowx;

int main(){
#ifdef WK
    freopen("in.txt","r",stdin);
#endif
    scanf("%d",&amp;n);

    for(int i=1;i&lt;=n;i++){
        LL aa;scanf("%lld",&amp;aa);
        LL ans=0;
        if(aa&gt;nowx)ans++;
        LL t=nowx^aa;int flag=-1;
        for(int i=62;i&gt;=0;i--){
            if(t&amp;(1ll&lt;&lt;i)){
                flag=i;break;
            }
        }
        if(flag!=-1){
            ans+=cnt[flag];
        }
        for(int i=0;aa;i++){
            if(aa&amp;1)cnt[i]++;
            aa&gt;&gt;=1;
        }
        nowx=t;
        printf("%lld\n",ans);
    }
    return 0;
} </code></pre>
</details>
<h2 id="e">E. 阔力梯的树<a class="headerlink" href="#e" title="Permanent link">Link</a></h2>
<p>给一颗带点权有根树</p>
<p>对于任意一颗子树定义它的结实程度为对它子树内所有节点的编号排序后获得数组 a, <span class="arithmatex"><span class="MathJax_Preview">\sum_{i=1}^{k-1}(a_{i+1}-a_i)^2</span><script type="math/tex">\sum_{i=1}^{k-1}(a_{i+1}-a_i)^2</script></span></p>
<p>显然考虑两个区间怎么合并，首先两个不交叉区间的元素不会互相影响权值，所以直接合并答案再加上边界的答案即可</p>
<p>直接考虑动态开点权值线段树合并即可</p>
<details class="note">
<summary>Code</summary>
<pre class="highlight"><code class="language-cpp">/*================================================================
*   Copyright (C) 2019 Sangfor Ltd. All rights reserved.
*
*   创 建 者： badcw
*   创建日期： 2020/1/13
*
================================================================*/
#include &lt;bits/stdc++.h&gt;

#define ll long long
using namespace std;

const int maxn = 1e5+50;
const int mod = 1e9+7;
ll qp(ll a, ll n) {
    ll res = 1;
    while (n &gt; 0) {
        if (n &amp; 1) res = res * a % mod;
        a = a * a % mod;
        n &gt;&gt;= 1;
    }
    return res;
}

template &lt;class T&gt;
inline bool scan(T&amp; ret) {
    char c;
    int sgn;
    if (c = getchar(), c == EOF) return 0; // EOF
    while (c != '-' &amp;&amp; (c &lt; '0' || c &gt; '9')) c = getchar();
    sgn = (c == '-') ? -1 : 1;
    ret = (c == '-') ? 0 : (c - '0');
    while (c = getchar(), c &gt;= '0' &amp;&amp; c &lt;= '9') ret = ret * 10 + (c - '0');
    ret *= sgn;
    return 1;
}

//template &lt;class T&gt;
//inline void out(T x) {
//    if (x &gt; 9) out(x / 10);
//    putchar(x % 10 + '0');
//}

int root[maxn];
int ls[1800000], rs[1800000];
ll res[maxn];
int sz = 0;

struct node {
    int lnum, rnum;
    ll ans;
}p[1800000];

void pushup(int rt) {
    p[rt].ans = p[ls[rt]].ans + p[rs[rt]].ans;
    if (p[ls[rt]].lnum) p[rt].lnum = p[ls[rt]].lnum;
    else p[rt].lnum = p[rs[rt]].lnum;
    if (p[rs[rt]].rnum) p[rt].rnum = p[rs[rt]].rnum;
    else p[rt].rnum = p[ls[rt]].rnum;
    if (p[rs[rt]].lnum == 0 || p[ls[rt]].rnum == 0) return;
    p[rt].ans += (ll)(p[rs[rt]].lnum - p[ls[rt]].rnum) * (p[rs[rt]].lnum - p[ls[rt]].rnum);
}

void insert(int &amp;k, int l, int r, int val){
    if (!k) k = ++sz;
    if (l == r) {
        p[k].lnum = p[k].rnum = val;
        p[k].ans = 0;
//        sum[k] = 1;
        return;
    }
    int mid = (l + r) &gt;&gt; 1;
    if (val &lt;= mid) insert(ls[k], l, mid, val);
    else insert(rs[k], mid + 1, r, val);
    pushup(k);
//    sum[k] = sum[ls[k]] + sum[rs[k]];
}

//int query(int k, int l, int r, int rank) {
//    if (l == r) return l;
//    int mid = (l + r) &gt;&gt; 1;
//    if (sum[ls[k]] &gt;= rank) return query(ls[k], l, mid, rank);
//    else return query(rs[k], mid + 1, r, rank - sum[ls[k]]);
//}

int merge(int x, int y) {
    if (!x) return y;
    if (!y) return x;
    ls[x] = merge(ls[x], ls[y]);
    rs[x] = merge(rs[x], rs[y]);
    pushup(x);
//    sum[x] = sum[ls[x]] + sum[rs[x]];
    return x;
}

int n;
vector&lt;int&gt; edge[maxn];

void dfs(int u) {
    insert(root[u], 1, n, u);
    for (auto v : edge[u]) {
        dfs(v);
        merge(root[u], root[v]);
    }
    res[u] = p[root[u]].ans;
}

int main(int argc, char* argv[]) {
    scanf("%d", &amp;n);
    for (int i = 2; i &lt;= n; ++i) {
        int rt;
        scanf("%d", &amp;rt);
        edge[rt].push_back(i);
    }
    dfs(1);
    for (int i = 1; i &lt;= n; ++i) {
        printf("%lld\n", res[i]);
    }
    return 0;
}</code></pre>
</details>
<h2 id="f">F. 采蘑菇的克拉莉丝<a class="headerlink" href="#f" title="Permanent link">Link</a></h2>
<details class="note">
<summary>Code</summary>
<pre class="highlight"><code class="language-cpp">#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N=2000010;
typedef long long LL;
int n,m;
struct edge{
    int b,nt,w;
}e[N];

int fa[N],wfa[N],sz[N];
int dfn[N],tt;
int p[N],nn;
void anode(int x,int y,int z){
    nn++;e[nn].b=y;e[nn].nt=p[x];p[x]=nn;e[nn].w=z;
    swap(x,y);
    nn++;e[nn].b=y;e[nn].nt=p[x];p[x]=nn;e[nn].w=z;
}
void dfs(int x,int ff=0){
    dfn[x]=++tt;sz[x]=1;
    for(int i=p[x];i;i=e[i].nt){
        int t=e[i].b;
        if(t==ff)continue;
        fa[t]=x;wfa[t]=e[i].w;
        dfs(t,x);
        sz[x]+=sz[t];
    }
}

int ROOT,ls[N*2],rs[N*2];
LL sum[N*2];
int cnt;
void build(int &amp;rt,int l,int r){
    rt=++cnt;
    if(l==r)return;
    int mid=l+r&gt;&gt;1;
    build(ls[rt],l,mid);
    build(rs[rt],mid+1,r);
}

void pushup(int rt){
    sum[rt]=sum[ls[rt]]+sum[rs[rt]];
}

void update(int rt,int l,int r,int x,int v){
    if(l==r){
        sum[rt]+=v;
        return;
    }
    int mid=l+r&gt;&gt;1;
    if(x&lt;=mid)update(ls[rt],l,mid,x,v);
    else update(rs[rt],mid+1,r,x,v);
    pushup(rt);
}

LL query(int rt,int l,int r,int x,int y){
    if(l==x&amp;&amp;r==y)return sum[rt];
    int mid=l+r&gt;&gt;1;
    if(y&lt;=mid)return query(ls[rt],l,mid,x,y);
    else if(x&gt;mid)return query(rs[rt],mid+1,r,x,y);
    else return query(ls[rt],l,mid,x,mid)+query(rs[rt],mid+1,r,mid+1,y);
}

int main(){
#ifdef WK
    freopen("in.txt","r",stdin);
#endif
    scanf("%d",&amp;n);
    for(int i=1;i&lt;n;i++){
        int aa,bb,cc;
        scanf("%d%d%d",&amp;aa,&amp;bb,&amp;cc);
        anode(aa,bb,cc);
    }
    dfs(1);
    build(ROOT,1,n);

    scanf("%d",&amp;m);
    int nowR=1;
    for(int tk=1;tk&lt;=m;tk++){
        int op;scanf("%d",&amp;op);
        if(op==1){
            int aa,bb;
            scanf("%d%d",&amp;aa,&amp;bb);
            update(ROOT,1,n,dfn[aa],bb);
        }else{
            int aa;scanf("%d",&amp;aa);
            nowR=aa;
        }

        LL ans=0;
        for(int i=p[nowR];i;i=e[i].nt){
            int t=e[i].b;
            if(t==fa[nowR])continue;
            ans+=1ll*e[i].w*query(ROOT,1,n,dfn[t],dfn[t]+sz[t]-1);
        }

        ans+=1ll*wfa[nowR]*(sum[ROOT]-query(ROOT,1,n,dfn[nowR],dfn[nowR]+sz[nowR]-1) ) ;
        printf("%lld\n",ans);
    }
    return 0;
} </code></pre>
</details>
<h2 id="h">H. 叁佰爱抠的序列<a class="headerlink" href="#h" title="Permanent link">Link</a></h2>
<p>题意相当于求一个最大的 m 使得 m 个点的完全图可以通过一条长度不超过 n - 1 的路径通过所有的边</p>
<p>显然对于 m 为奇数时，完全图中每个点的度数为偶数，则必然存在一条欧拉路使得通过所有点</p>
<p>对于 m 为偶数时，对于每个奇偶点多连一条边就可以使得每个点的度数变为偶数，就可以通过欧拉路求解</p>
<p>欧拉路算法为： <code>fleury</code></p>
<p>m 为偶数时 n 最大为 <code>m * m / 2</code></p>
<p>m 为奇数时 n 最大为 <code>m * (m - 1) / 2 + 1</code></p>
<details class="note">
<summary>Code</summary>
<pre class="highlight"><code class="language-cpp">#include &lt;bits/stdc++.h&gt;
#define ll long long
using namespace std;

const int N=2010;
const int mod = 1e9+7;
ll n;

ll cal2(ll x) { return x * x / 2; }
ll cal1(ll x) { return x * (x - 1) / 2 + 1; }

struct edge{
    int a,b,nt,pre;
}e[N*N];
int p[N],nn;
void anode(int x,int y){
    e[nn].b=y;e[nn].nt=p[x];if(p[x]!=-1)e[p[x]].pre=nn;p[x]=nn;e[nn].a=x;e[nn].pre=-1;nn++;
    swap(x,y);
    e[nn].b=y;e[nn].nt=p[x];if(p[x]!=-1)e[p[x]].pre=nn;p[x]=nn;e[nn].a=x;e[nn].pre=-1;nn++;
}

void del(int i){
    if(e[i].pre!=-1)e[e[i].pre].nt=e[i].nt;
    if(e[i].nt!=-1)e[e[i].nt].pre=e[i].pre;
    if(i==p[e[i].a])p[e[i].a]=e[i].nt;
}

void add(int i){
    e[i].nt=p[e[i].a];
    if(p[e[i].a]!=-1)e[p[e[i].a]].pre=i;
    p[e[i].a]=i;
}

void build(int m){
    for(int i=1;i&lt;=m;i++)p[i]=-1;
    for(int i=1;i&lt;=m;i++){
        for(int j=i+1;j&lt;=m;j++)anode(i,j);
    }
    if(m&amp;1)return;
    for(int i=1;i&lt;=m;i+=2){
        anode(i,i+1);
    }
}

int st[N*N],ans[N*N];

void dfs(int x){
    st[++st[0]]=x;
    for(int i=p[x];i!=-1;i=e[i].nt){
        int t=e[i].b;
        del(i);
        del(i^1);
        dfs(t);
        break;
    }
}

void solve(){
    st[++st[0]]=1;
    while(st[0]){
        int u=st[st[0]--],flag=0;
        if(p[u]!=-1)dfs(u);
        else ans[++ans[0]]=u;
    }
}

int main(int argc, char* argv[]) {
#ifdef WK
    freopen("in.txt","r",stdin);
    freopen("out.txt","w",stdout);
#endif
    scanf("%lld", &amp;n);
    if(n==1){
        printf("1\n1");
        return 0;
    }
    ll l = 1, r = 1e9+5;
    ll res = 0;
    while (l &lt;= r) {
        ll mid = l + r &gt;&gt; 1;
        if (cal1(mid * 2 + 1) &gt; n) {
            r = mid - 1;
        } else {
            res = mid * 2 + 1;
            l = mid + 1;
        }
    }
    l = 1, r = 1e9+5;
    ll res1 = 0;
    while (l &lt;= r) {
        ll mid = l + r &gt;&gt; 1;
        if (cal2(mid * 2) &gt; n) {
            r = mid - 1;
        } else {
            res1 = mid * 2;
            l = mid + 1;
        }
    }
    res = max(res, res1);
    printf("%lld\n", res);
    if(n&gt;2000000)return 0;

    build(res);
    solve();
    while(ans[0]&lt;n)ans[++ans[0]]=1;
    for(int i=1;i&lt;=n;i++){
        printf("%d%c",ans[i],(i==n)?'\n':' ');
    }
    return 0;
}</code></pre>
</details>
<h2 id="j-2-sat">J. 邦邦的2-SAT模板<a class="headerlink" href="#j-2-sat" title="Permanent link">Link</a></h2>
<details class="note">
<summary>Code</summary>
<pre class="highlight"><code class="language-cpp">#include &lt;bits/stdc++.h&gt;

using namespace std;
typedef long long ll;

int main()
{
    int n;
    scanf("%d", &amp;n);
    if(n == 1) return 0 * puts("0");
    printf("%d\n", n);
    for(int i = 1; i &lt; n; i ++) printf("%d %d\n", -i, i + 1);
    printf("%d %d\n", -n, -n);
    return 0;
}</code></pre>
</details>
<details class="note">
<summary>题目附录</summary>
<pre class="highlight"><code class="language-cpp">#include&lt;cstdio&gt;
using namespace std;
const int N=3010;
int g[N&lt;&lt;1],nxt[N&lt;&lt;1],v[N&lt;&lt;1],num;
int q[N&lt;&lt;1],t;
bool vis[N&lt;&lt;1];
int CNT;
int n,m;
void add(int x,int y){
    nxt[++num]=g[x];
    v[num]=y;
    g[x]=num;
}
bool dfs(int x){
    CNT++;
    if(vis[x&gt;n?x-n:x+n])return 0;
    if(vis[x])return 1;
    vis[q[++t]=x]=1;
    for(int i=g[x];i;i=nxt[i])if(!dfs(v[i]))return 0;
    return 1;
}
bool solve(){
    for(int i=1;i&lt;=n;i++)if(!vis[i]&amp;&amp;!vis[i+n]){
        t=0;
        if(!dfs(i)){
            while(t)vis[q[t--]]=0;
            if(!dfs(i+n))return 0;
        }
    }
    return 1;
}
int main()
{
    scanf("%d%d",&amp;n,&amp;m);
    for(int i=1;i&lt;=m;i++)
    {
        int x,y;scanf("%d%d",&amp;x,&amp;y);
        if(x&lt;0)x=n-x;if(y&lt;0)y=n-y;
        add(x&gt;n?x-n:x+n,y);add(y&gt;n?y-n:y+n,x);
    }
    solve();
    return 0;
}</code></pre>
</details>
<h2 id="k">K. 破忒头的匿名信<a class="headerlink" href="#k" title="Permanent link">Link</a></h2>
<details class="note">
<summary>Code</summary>
<pre class="highlight"><code class="language-cpp">#include &lt;bits/stdc++.h&gt;

using namespace std;
typedef long long ll;

const int maxn = 5e5 * 26;
const int N = 5e5 + 10;

int trie[maxn][26], cnt;
int tag[maxn];
int fail[maxn];
int val[maxn], dep[maxn];

void ins(char *s, int V)
{
    int root =0;
    for(int i = 0; s[i]; i ++)
    {
        int id = s[i] - 'a', fa = root;
        if(!trie[root][id]) trie[root][id] = ++ cnt;
        root = trie[root][id];
        dep[root] = dep[fa] + 1; 
    }
    tag[root] = true;
    val[root] = min(val[root], V);
}

void build()
{
    queue&lt;int&gt; que;
    for(int i = 0; i &lt; 26; i ++) if(trie[0][i]) que.push(trie[0][i]);
    while(!que.empty())
    {
        int k = que.front();
        que.pop();
        for(int i = 0; i &lt; 26; i ++)
        {
            if(trie[k][i])
            {
                fail[trie[k][i]] = trie[fail[k]][i];
                que.push(trie[k][i]);
            }else trie[k][i] = trie[fail[k]][i];
        }
    }
}

char s[maxn], t[maxn];
ll dp[N];

void query()
{
    int u = 0, len = strlen(t + 1);
    memset(dp, 0x3f, sizeof dp);
    dp[0] = 0;
    for(int i = 1; i &lt;= len; i ++)
    {
        u = trie[u][t[i] - 'a'];
        int en = u;
        while(en)
        {
            if(tag[en] &amp;&amp; dp[i - dep[en]] != 0x3f3f3f3f) dp[i] = min(dp[i], dp[i - dep[en]] + val[en]);
            en = fail[en];
        }
    }
    if(dp[len] == 0x3f3f3f3f3f3f3f3f) dp[len] = -1;
    printf("%lld\n", dp[len]);
}

int main()
{
    int n, x;
    scanf("%d", &amp;n);
    memset(val, 0x3f, sizeof val);
    for(int i = 1; i &lt;= n; i ++) 
    {
        scanf("%s%d", s, &amp;x);
        ins(s, x);
    }
    build();
    scanf("%s", t + 1);
    query();
    return 0;
}</code></pre>
</details>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy;  <a href="https://wiki.badcw.cn" target="_blank">wiki.badcw.cn</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c99f48ec.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../search/main.js"></script>
      
    
  </body>
</html>